package security;

import io.jsonwebtoken.ExpiredJwtException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@Component
public class JwtFilter extends OncePerRequestFilter {

    @Autowired
    private JwtUtil jwtUtil;

    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain)
            throws ServletException, IOException {
        String header = request.getHeader("Authorization");
        String email = null;
        String token = null;

        if (header != null && header.startsWith("Bearer ")) {
            token = header.substring(7);
            try {
                email = jwtUtil.extractEmail(token);
//[_{{{CITATION{{{_1{](https://github.com/g00glen00b/gatsby-blog/tree/f5ecb473a37d63e7594ea5802fc4aa60cdfe6714/content%2Fposts%2F2014-12-20-prototyping-spring-boot-angularjs%2Findex.md)[_{{{CITATION{{{_2{](https://github.com/xudc0521/spring-boot-v2/tree/bcffe108023c86bd00c39f049808e40c4c7e3803/spring-boot-v2-param-valid%2FREADME.md)[_{{{CITATION{{{_3{](https://github.com/sakuraEEE/Repository/tree/68acdb8ab451bab43820d051a54f37ab76e8f7cc/source%2Fprogram-working%2FThymeleaf%2F%E4%B8%8A%E8%AF%BE%E7%AC%94%E8%AE%B0.md)[_{{{CITATION{{{_4{](https://github.com/zivjie/springboot-demo/tree/ea383eeb36c7295ccfe196394e3b9c3f0ce8e799/spring-boot-demo-upload%2FREADME.md)[_{{{CITATION{{{_5{](https://github.com/YorkChow163/notes-everthing/tree/a951aa3cbfbedea875ac529adc69ae7f6b2cdf32/docker%2Fdocker_from_maven.md)[_{{{CITATION{{{_6{](https://github.com/zhl-yang/spring-boot-demo/tree/9b9a24d7dcc37dbfc97cd845ab35409ec8b3c347/spring-boot-demo-template-thymeleaf%2FREADME.md)[_{{{CITATION{{{_7{](https://github.com/wkf-87/SSO/tree/40b3b14c91e414591fbb75d9219e3f7cc546931e/Extended%20experiment%2FCAS+SpringBoot%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95.md)[_{{{CITATION{{{_8{](https://github.com/balajk/my-spring-boot-examples/tree/b6c4c71a1080d4f1ecc76faa1c9c24765cf0a2cd/spring-boot-2-rest-service-content-negotiation%2Fcode-nov-2017.md)[_{{{CITATION{{{_9{](https://github.com/DurgaPrasadVinukonda/docker-crash-course/tree/ee8cb0a0921cfb3843b7fa3d445379fc8511f4b6/05-microservices%2Fcode-backup%2F01-starting-point-with-docker-compose.md)[_{{{CITATION{{{_10{](https://github.com/LIULE8/liule8/tree/e249681e2a1868e74eb855323203c23da2feec0e/blog%2Fsource%2F_posts%2FSpringSecurity%E4%B9%8B%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98%28%E4%B8%80%29.md)[_{{{CITATION{{{_11{](https://github.com/gopipolana/springboot/tree/47fbf7ad9541d6e3a29408c2279cb9c7b77539a4/02.Spring-Boot-Web-Application%2FStep26.md)[_{{{CITATION{{{_12{](https://github.com/hantsy/building-restful-apis-with-springmvc-gitbook/tree/3a8cfda05fd9da8382a3e0236c2a530fd4b7e1b3/boot%2Finit.md)[_{{{CITATION{{{_13{](https://github.com/Jayden-Chiu/PollCaster-Backend/tree/439434ce2c18d6256629601cad7407af830a0704/README.md)[_{{{CITATION{{{_14{](https://github.com/peje86/praxis_academy/tree/0706e7f6d27a0ff790c0a89feb286a04a537a84e/novice%2F03-05%2FlangkahloginRoleJwt.md)[_{{{CITATION{{{_15{](https://github.com/AppCraft-Projects/t360-java-security/tree/d441a0dcb60a6302c0062f933b4175c9596b6968/NOTES.md)[_{{{CITATION{{{_16{](https://github.com/gwanghui/kwangHexo/tree/0bf40977799ec4617fb0fdda3bf86cf6ea6fa872/source%2F_posts%2Fspring-security.md)[_{{{CITATION{{{_17{](https://github.com/abhnin/musigma-mart/tree/9ee3b4af4fcde5d007f3acf6aa71c5a00398859f/src%2Fmain%2Fjava%2Fmusigmamart%2Fauth%2FSecurityConfiguration.java)[_{{{CITATION{{{_18{](https://github.com/seongbinko/remember_dream_v2/tree/7f565c6cd1e8d3bc3dd45050f3f9c2c0fad3f63e/src%2Fmain%2Fjava%2Fshop%2Fdream%2Fconfig%2FWebSecurityConfig.java)[_{{{CITATION{{{_19{](https://github.com/jahs-es/formacion-tdd/tree/217ebf78841cc6804c29a5e7cbe9cfdb5a9fbb0c/src%2Fmain%2Fjava%2Fcom%2Fformaciontdd%2Fconfiguration%2FWebSecurityConfiguration.java)[_{{{CITATION{{{_20{](https://github.com/bleachjade/secure-message-product-random-validate/tree/f1d533f112da15dca0ceff8e1b7636bc9751db33/src%2Fmain%2Fjava%2Fku%2Fmessage%2Fconfig%2FSecurityConfig.java)[_{{{CITATION{{{_21{](https://github.com/heraldovalenti/hydro-backend/tree/ebbc3eb8d772156bba91ac2a7185b7134c44da8b/src%2Fmain%2Fjava%2Fcom%2Faes%2Fdashboard%2Fbackend%2Fconfig%2FWebSecurityConfig.java)[_{{{CITATION{{{_22{](https://github.com/alcircesar/Prototipos/tree/d7fc2d2b37b961dd1b9e5f2a1c1535b12e339864/src%2Fmain%2Fjava%2Fbr%2Fcom%2Fprototipos%2Ftasks%2Fconfig%2FWebSecurityConfig.java)[_{{{CITATION{{{_23{](https://github.com/MonjurMorshedMunna/lifebook-app/tree/8481f190c8c21677b409afe939a93883690c4823/lifebook-client%2Fsrc%2Fmain%2Fjava%2Forg%2Flifebook%2Fconfiguration%2FWebSecurityConfig.java)[_{{{CITATION{{{_24{](https://github.com/javabyd1/JuniorJavaJobFinder/tree/4b45d699261b3c3ce7f4fc03ee604d8d5743923b/src%2Fmain%2Fjava%2Fcom%2Fsda%2Fjuniorjavajobfinder%2Fgroupproject%2Fconfig%2FSecurityConfig.java)[_{{{CITATION{{{_25{](https://github.com/rrotnem/appointments-app/tree/39ac5b3cd102b995487af5b1f0873f20e1c7b577/src%2Fmain%2Fjava%2Fedu%2Ffranklin%2Fappointments%2Fconfig%2FWebSecurityConfig.java)[_{{{CITATION{{{_26{](https://github.com/Connor-Grehlinger/UrSchedulerWebApp/tree/eb8f30d8c6bd022b0aa934401c42705e6b64b5af/meetingManager%2Fsrc%2Fmain%2Fjava%2Fedu%2FTeamAlpha%2FmeetingManager%2FWebSecurityConfig.java)[_{{{CITATION{{{_27{](https://github.com/SpringBootLessons/Lesson15_1/tree/359a81aa52c1468acae53e146e0447577d911592/README.md)[_{{{CITATION{{{_28{](https://github.com/MaiNorapong/secure-message-product-random-validate/tree/005690011c9fcbfbaa091ad3a27834f7b8490040/src%2Fmain%2Fjava%2Fku%2Fmessage%2Fcontroller%2FSignupController.java)[_{{{CITATION{{{_29{](https://github.com/trentbroome/CSCI-3300-Team-Project/tree/f801ede063afee6e913ad8ae1ac487b43832401a/complete%2Fsrc%2Fmain%2Fjava%2Fcom%2Fexample%2Fservingwebcontent%2FMainController.java)[_{{{CITATION{{{_30{](https://github.com/fitsumtsehay/SpringBoot_3.02/tree/e13e1b09c7716b79265346134ee48558e3d83fc5/src%2Fmain%2Fjava%2Fcom%2Fexample%2Fdemo%2FHomeController.java)[_{{{CITATION{{{_31{](https://github.com/Arach-Corp/EpicTask/tree/12aec785ffed35fbfaf0529eb2548d4f6f9bb89b/src%2Fmain%2Fjava%2Fbr%2Fcom%2Ffiap%2Fepictask%2Fcontroller%2FLoginController.java)[_{{{CITATION{{{_32{](https://github.com/Elisavett/climateDBase/tree/bc548a3c0e50fee7fc3e54ab6cb6c631eeafb5dd/src%2Fmain%2Fjava%2Fnet%2Fcompany%2Forders%2Fcontroller%2FAuthController.java)[_{{{CITATION{{{_33{](https://github.com/alexander-sapozhnikov/OfferNode/tree/714226d555ed6ea91282ac24ec1c38e4d9207d9c/src%2Fmain%2Fjava%2Fru%2Fsapozhnikov%2Fsecurity%2FJwtRequestFilter.java)[_{{{CITATION{{{_34{](https://github.com/daizy1930/JAVA-MAJOR-BACKEND-FINAL/tree/aadeb14b0c171d8d698ea8fb83cf831ad427ab09/ADMIN-JAVA-SORTED-UPDATE-main%2Fjava-majorr-G6%2Fsrc%2Fmain%2Fjava%2Fcom%2Fexample%2Fsecurity%2FJwtAuthenticationFilter.java)[_{{{CITATION{{{_35{](https://github.com/renceabishek/read-bible-service/tree/68626f0d5cf7b48c7efc0ead2450ae09ccac045f/src%2Fmain%2Fjava%2Fcom%2Fread%2Freadbibleservice%2Fcontroller%2FAuthController.java)[_{{{CITATION{{{_36{](https://github.com/Nikhi69/springrest/tree/7ff7f319a071f70cd8e86058613fba1934f2d9b2/ormfinal4%2Fsrc%2Fmain%2Fjava%2Fcom%2Fnikhil%2Ftruyum%2Fjwt%2FJwtTokenAuthorizationOncePerRequestFilter.java)[_{{{CITATION{{{_37{](https://github.com/hysro1997/store/tree/b7184463fab463c9576fdfa622cedc1c443ad8d7/src%2Fmain%2Fjava%2Fcom%2Fgegehydro%2Fstore%2Fsecurity%2FJwtAuthenticationTokenFilter.java)[_{{{CITATION{{{_38{](https://github.com/jj-web-design-studio/jjstudio-backend-java/tree/5fcbe7a1811c43f74889e9e9e3a06d88e82fa096/src%2Fmain%2Fjava%2Fcom%2Fjjstudio%2Ffilter%2FJwtRequestFilter.java)[_{{{CITATION{{{_39{](https://github.com/skanderhk/GestionFormation/tree/f570b65adbef8ace7dc357e2443a8cd68851d58b/src%2Fmain%2Fjava%2Fcom%2Fipsas%2FGestionDeFormations%2FJwt%2FJwtFilter.java)[_{{{CITATION{{{_40{](https://github.com/JayanthTadikonda/Application_Final/tree/8f6810e8d8baf39ca79871ba669885c4a54f2328/MongoDB-UserCreation%2Fsrc%2Fmain%2Fjava%2Fcom%2Fjay%2FMongoDBUserCreation%2Ffilter%2FJwtFilter.java)[_{{{CITATION{{{_41{](https://github.com/abanidas/discussion-board-microservice/tree/6f7952bde1e05d4a98d27ae63e5a21d98475809d/microservice-backend%2Fuser-service%2Fsrc%2Fmain%2Fjava%2Fcom%2Fabani%2Fmicroservice%2Fdiscussionboard%2Ffilter%2FJwtFilter.java)
            } catch (Exception e) { 
            		// Código para manejar la excepción 
            	}
            }
        }
}